import Post from '../../components/Post'
import Show from '../../components/Show'
import Divider from '../../components/Divider'
import ScrollToTop from '../../components/ScrollToTop'
import FooterEnd from '../../components/FooterEnd'
import DemoAndSource from '../../components/DemoAndSource'

import { data } from '../../data/block-floc'

export const meta = {
  title: 'Blocking FLoC on Vercel',
  description: "FLoC is problematic, so let's learn how to block it on a Vercel hosted site.",
  date: 'April 28, 2021',
  coverImage: '/images/block-floc/cover-image.png',
}

export default ({ children }) => <Post meta={meta}>{children}</Post>

# Blocking FLoC on Vercel

<ScrollToTop />

![Cover Image](/images/block-floc/cover-image-large.png)

<DemoAndSource demo="https://nownano-guides.vercel.app/" source="https://gist.github.com/Technopathic/4b454df02ce2727c5487fed79e500d46" />

Hey everyone! If you've haven't heard Google has launched a new tracking method in Chrome called Federated Learning of Cohorts (FLoC). Without your consent, you've been automatically entered into it. As quoted from spreadprivacy.com: 

> It groups you based on your interests and demographics, derived from your browsing history, to enable creepy advertising and other content targeting without third-party cookies.

It would seem not everyone is too happy about being a statistic without a choice. Many critics also believe having their browsing history analyzed and being provided targeted ads completely violates their privacy. 

For more information on FLoC, the team behind DuckDuckGo have written up this <a href="https://spreadprivacy.com/block-floc-with-duckduckgo/" target="_blank" rel="noopener noreferrer">article</a> which provides options on what you can do about it.

## What can Web Devs do about it?

As web developers, we also have the ability to protect the privacy of our user by opting out of FloC throughout the website. This can be accomplished by setting the `Permissions-Policy` HTTP response header.

```
Permissions-Policy: interest-cohort=()
```

If you were to check out the headers sent by my website, <a href="https://nownano.tv" target="_blank" rel="noopener noreferrer">NowNano</a>, you'll see that I already have this header set and strongly encourage others to do the same.

<br/>

![Nownano Headers](/images/block-floc/headers-floc.png)
<br />

My website is also hosted on Vercel, so today I'll show you how to set these headers on your Vercel hosted website.

<Divider /> 

## Headers in vercel.json

In the root of your project, create a new file called `vercel.json`, while will allow us to set a number of <a href="https://vercel.com/docs/edge-network/headers" target="_blank" rel="noopener noreferrer">headers and custom headers</a>. Once you've done that, we will add the `headers` array which will contain objects specifying headers for any sources (pages, assets, etc). For now, we will add our headers for all of our page sources.

![Code Snippet](/images/block-floc/0.svg)

<Show label="Code" content={0} data={data}/>

We set our "source" as `/(.*)`; this is a greedy regex which will search for all pathnames after our root (`/`) and apply the second `headers` array to those pathnames.

Finally, you need to push your repo changes to Git and your pages should automatically begin serving your new `Permissions-Policy: interest-cohort=()` header on all pages.


<FooterEnd 
    title="Congratulations!" 
    message="You've reached the end of this guide! You can check out the demo and source code down below. While you're at it, consider supporting the blog, it helps keep me motivated to create more guides and I greatly appreciate it." 
    related={[{ title: 'A.I. images with Deep Daze', url: '/AI-images-with-Deep-Daze'}]} 
    demo="https://nownano.tv"
    source="https://gist.github.com/Technopathic/4b454df02ce2727c5487fed79e500d46"
/>